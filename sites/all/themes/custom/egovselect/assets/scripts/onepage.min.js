!function(e){var i=0,t=!1,s=!1,a=0,o=function(){return e("button.icon-menu").is(":visible")},n=e(window).height(),l=e(window).width();e("html").removeClass("no-js").addClass("js");var c=function(i){if(!i.is(":visible"))return{distance:-1,absolute_distance:-1,visible:0,position:-1};var t=e(window).scrollTop(),s=e(window).height(),a=(e(window).width(),t+s),n=t+s/2,l=i.offset(),c=l.top;"home"==i.attr("id")&&(o()?c+=e("#tools").height():c+=e("#navbar").height());var r=i.height(),h=c+r/2,v=n-h,d="center",f=1,u=!1;return v>0?(d="before",f=c+r>t+1):v<0&&(d="after",f=c<a-1),c-t<s/2&&(u=!0),{distance:v,absolute_distance:Math.abs(v),visible:f,position:d,section_height:r,active:u}};Drupal.behaviors.egov_onepage={attach:function(r,h){var v=e("#egovselect-page"),d=e("#content-to-resize").height(),f=e("body"),u=e("#home-sections"),g=u.find(".home-section:not(.home-sub-section)"),p=e("#navigation .block-menu"),m=p.find("a"),b=v.scrollTop();if(o())var w=47;else var w=116;var C=function(e,i){i.preventDefault(),location.pathname.replace(/^\//,"")==e.pathname.replace(/^\//,"")&&location.hostname==e.hostname&&k(e.hash,500,!0)},k=function(t,o,l){if(!1===s&&(!f.hasClass("container--has-focus")||l)){var c=e(t);if(c=c.length?c:e("[name="+t.slice(1)+"]"),c.length){var r=c.position().top;r>=n-w&&(r+=w),0==o?(v.scrollTop(r),b=v.scrollTop(),M(),x(b),i=0,document.body.classList.remove("container--has-focus")):(a=(new Date).getTime(),s=!0,v.animate({scrollTop:r},o,function(){}).promise().then(function(){b=v.scrollTop(),M(),x(b),i=0,s=!1,window.location.hash=t,document.body.classList.remove("container--has-focus")}))}}},x=function(e){f.hasClass("header-expanded")&&e>50&&!o()?f.removeClass("header-expanded"):!f.hasClass("header-expanded")&&e<50&&f.addClass("header-expanded")},T=function(){l>=768&&n>=554?(e("html").addClass("hide-scrollbar"),g.each(function(i,t){if(e(this).css("min-height",n),e(".block-navigation .menu li a",this).css("min-height","0"),0!=i&&e(".section-wrapper",this).css("height",n),3==i){var s=n-190;e("iframe",this).attr("height",s),e("iframe",this).css("height",s)}if(4==i){var a=n-250;e("iframe",this).attr("height",a),e("iframe",this).css("height",a)}}),e("#egovselect-page").css("overflow-y","scroll"),e("html, body, #egovselect-page").css({height:n})):(e("html").addClass("hide-scrollbar"),g.each(function(i,t){e(this).css("min-height","0"),e(".block-navigation .menu li a",this).css("min-height","245px"),0!=i&&e(".section-wrapper",this).css("height","100%")}),e("#egovselect-page").css("overflow-y","auto"),e("#egovselect-page").css("-webkit-overflow-scrolling","touch"),e("html, body, #egovselect-page").css({height:"100%"})),d=e("#content-to-resize").height()},D=function(){if(l>=768&&n>=554){e(window).bind("mousewheel DOMMouseScroll MozMousePixelScroll",function(e){if((new Date).getTime()-a<950)return e.preventDefault(),!1;if((0==b||b>=d-n)&&(i=0),i>0){if(s)return e.preventDefault(),!1}else if(e.preventDefault(),!1===s){i++;var t=parseInt(e.originalEvent.wheelDelta||-e.originalEvent.detail);Math.abs(t)>=1&&(t>0?b-=2:b+=2,b+n-w>d&&(b=d+w-n),v.scrollTop(b))}}),e(document).keydown(function(e){if(-1!=[38,40,32,33,34,36,35].indexOf(e.which))if((0==b||b>=d-n)&&(i=0),i>0){if(s)return!1}else if(e.preventDefault(),!1===s){i++;var t=e.target.tagName.toLowerCase(),a=1;switch(e.which){case 38:"input"!=t&&"textarea"!=t&&(a=1);break;case 40:case 32:"input"!=t&&"textarea"!=t&&(a=-1);break;case 33:"input"!=t&&"textarea"!=t&&(a=1);break;case 34:"input"!=t&&"textarea"!=t&&(a=-1);break;case 36:a=1;break;case 35:a=-1;break;default:return}a>0?b-=2:b+=2,b+n-w>d&&(b=d+w-n),v.scrollTop(b)}});var t=0;e("#egovselect-page").on("touchmove",function(e){e.preventDefault(),e.stopPropagation();var i=e.originalEvent.touches[0].clientY;Math.abs(i-t)>=50&&(i>t?b+=2:i<t&&(b-=2),v.scrollTop(b)),t=i})}},y=function(e){if(null==e)g.filter(".section-active").trigger("deactivate"),g.removeClass("section-active"),m.removeClass("section-link-active").blur();else{g.filter(".section-active").not(e).trigger("deactivate"),e.hasClass("section-active")||e.trigger("activate"),g.not(e).removeClass("section-active"),e.addClass("section-active");var i=e.attr("id"),t=m.filter('a[href$="#'+i+'"]');m.not(t).removeClass("section-link-active").blur(),t.addClass("section-link-active")}},M=function(i){var t=null,s=!1,a=null,o=null,n=0;g.each(function(){var i=c(e(this));n+=i.section_height;var l=e(this).attr("id"),r=m.filter('a[href$="#'+l+'"]');(null==t||i.active)&&(a=e(this),void 0!==r&&(o=r),t=i,t.name=l),i.visible?(e(this).hasClass("section-visible")||e(this).trigger("appear"),e(this).addClass("section-visible"),r.addClass("section-link-visible"),s=!0):(e(this).hasClass("section-visible")&&e(this).trigger("disappear"),e(this).removeClass("section-visible"),r.removeClass("section-link-visible")),e(this).removeClass("section-after"),e(this).removeClass("section-before"),r.removeClass("section-link-before"),r.removeClass("section-link-after"),e(this).addClass("section-"+i.position),r.addClass("section-link-"+i.position),s?(f.addClass("sections-visible"),y(a)):(f.removeClass("sections-visible"),y(null))}),g.sections_height=n};T(),e(window).load(function(){t=!0;var e=window.location.hash;e&&k(e,0,!1),M(),D()}),v.scroll(function(){b=v.scrollTop(),x(b),M(),!e("html, body").is(":animated")&&!1===s&&t&&l>=768&&n>=554&&g.each(function(i,t){e(this).hasClass("section-visible")&&!e(this).hasClass("section-active")&&k("#"+e(this).attr("id"),450,!1)})}),e(window).resize(function(){n=e(window).height(),l=e(window).width(),T(),o()?(f.addClass("header-expanded"),e("#content-to-resize").css("padding-top",e("#tools").height()),w=47):(e("#content-to-resize").css("padding-top",e("#navbar").height()),w=116,b>50&&f.removeClass("header-expanded"))}),e('a[href*="#"]:not([href="#"])').click(function(e){C(this,e)})}}}(jQuery);